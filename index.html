<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simba Express | Duka lako, jukumu letu.</title>
    <link rel="icon" type="image/png" href="/favicon/favicon-pro.jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; scroll-behavior: smooth; }
        .hero-bg {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('favicon/Simba\ banner\ sample.jpeg');
            background-size: cover; background-position: center;
        }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; padding: 1rem; }
        .modal.active { display: flex; }
        .category-tab.active { border-color: #dc2626; color: #dc2626; background-color: #fef2f2; }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* Android-Friendly Scrollable Modal */
        .modal-content-scroll {
            max-height: 85vh; /* Prevents popup from being taller than the screen */
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            width: 95%; /* More width on mobile */
            margin: auto;
        }

        /* Slimmer inputs for mobile thumb typing */
        input[type="tel"], input[type="text"] {
            font-size: 16px !important; /* Prevents iOS/Android auto-zoom on focus */
            padding: 12px !important;
        }

        /* Fixed Product Detail for Mobile */
        .product-modal-content {
            max-height: 90vh; /* Limits height to 90% of screen */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevents the whole box from scrolling */
        }

        .scrollable-content {
            overflow-y: auto; /* Only the image and text scroll */
            flex-grow: 1;
        }

        .fixed-bottom-actions {
            background: white;
            border-top: 1px solid #f3f4f6;
            padding: 1rem;
            z-index: 10;
        }

        /* Success Toast Notification */
        #success-toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #059669; /* Emerald Green */
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 50px;
            transform: translateX(-50%);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        #success-toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from { bottom: 0; opacity: 0; }
            to { bottom: 50px; opacity: 1; }
        }

        @keyframes fadeout {
            from { bottom: 50px; opacity: 1; }
            to { bottom: 0; opacity: 0; }
        }
  
    </style>
</head>
<body class="bg-white text-gray-900">

   <nav class="fixed top-0 left-0 right-0 bg-white border-b z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between w-full">
            <div class="flex items-center">
                <img src="/favicon/simba_croped2_cropped.png" alt="Logo" class="h-10 w-auto">
            </div>
            <div class="flex items-center space-x-4 text-[11px] font-black uppercase">
                <button onclick="openPopup('about-modal')" style="color: #E60000;">KUHUSU</button> 
                <span class="text-gray-300">|</span> 
                <button onclick="openPopup('contact-modal')" style="color: #E60000;">MSAADA</button>
            </div>
        </div>
   </nav>

<div class="h-20"></div>

    <header class="hero-bg min-h-[450px] lg:min-h-[650px] flex flex-col items-center justify-center text-white text-center px-4 pt-44 lg:pt-52 pb-12">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl lg:text-6xl font-black mb-4 drop-shadow-2xl">
                Duka lako, jukumu letu.
            </h1>
            <h2 class="text-xl lg:text-3xl font-light mb-8 text-white italic drop-shadow-lg">
                Mzigo Unafika Ndani ya Dakika 60
            </h2>
            
            <div class="inline-block bg-white/10 backdrop-blur-md px-8 py-3 rounded-full border border-white/20 shadow-xl">
                <p class="text-xl lg:text-2xl font-bold">Usafiri ni Tsh 5,000 tu Popote Dar</p>
            </div>
        </div>
    </header>

    <div id="about-modal" class="modal" onclick="closePopup('about-modal')">
        <div class="bg-white p-8 max-w-md rounded-sm shadow-2xl relative" onclick="event.stopPropagation()">
            <div class="text-red-600 text-3xl mb-4"></div>
            <h2 class="text-2xl font-black mb-4 uppercase tracking-tighter italic text-red-600">Sisi ni Akina Nani?</h2>
            <p class="text-gray-700 text-base mb-4 leading-relaxed">
                Simba Express tuko hapa kukusaidia Mjasiriamali wa Kitanzania. Tunajua changamoto za kufunga duka na kwenda sokoni kutafuta mzigo ni kupoteza muda na wateja.
            </p>
            <p class="text-gray-700 text-base mb-6 font-bold">
                Dhumuni letu ni moja tu: Wewe baki dukani uuze, sisi tutakuhangaikia mzigo ukufikie. Tunaleta bidhaa mpaka mlangoni kwako kwa bei ile ile ya soko. Hakuna usumbufu!
            </p>
            <button onclick="closePopup('about-modal')" class="w-full bg-black text-white py-3 text-xs font-bold uppercase tracking-widest hover:bg-red-600 transition">Nimeelewa, Turudi Kwenye Biashara</button>
        </div>
    </div>


    <div id="contact-modal" class="modal" onclick="closePopup('contact-modal')">
        <div class="bg-white p-8 max-w-md rounded-sm shadow-2xl relative" onclick="event.stopPropagation()">
            <div class="text-green-600 text-3xl mb-4"></div>
            <h2 class="text-2xl font-black mb-4 uppercase tracking-tighter italic text-red-600">Wasiliana nasi</h2>
            <p class="text-gray-600 text-sm mb-6">
                Una swali au unataka oda maalum? Tupigie au tutumie ujumbe WhatsApp sasa hivi.
            </p>
            <div class="space-y-4 mb-8">
                <div class="flex items-center gap-4 border-b pb-3">
                    <span class="text-xl">üìç</span>
                    <div>
                        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Ofisi Zetu</p>
                        <p class="font-bold text-sm text-gray-800">Mtaa wa Aggrey, Kariakoo, Dar es Salaam</p>
                    </div>
                </div>
               <div class="flex items-center gap-4 border-b pb-4 group">
                    <a href="https://wa.me/255685636220" target="_blank" class="text-2xl hover:scale-110 transition-transform cursor-pointer">
                        üü¢
                    </a>
                    
                    <div class="flex-1">
                        <p class="text-[10px] text-gray-400 font-black uppercase tracking-widest mb-1">
                            Piga simu / WhatsApp
                        </p>
                        
                        <a href="tel:+255685636220" 
                        class="block font-black text-lg text-gray-800 hover:text-red-600 transition-colors active:opacity-60">
                            +255 685 636 220
                        </a>
                    </div>

                    <a href="tel:+255685636220" class="bg-red-600 text-white p-2 rounded-full shadow-md md:hidden">
                        üìû
                    </a>
               </div>
            </div>
            <button onclick="closePopup('contact-modal')" class="w-full bg-red-600 text-white py-3 text-xs font-bold uppercase tracking-widest hover:bg-red-700 transition">Nimeelewa, Turudi Kwenye Biashara</button>
        </div>
    </div>

    <section class="max-w-xl mx-auto -mt-12 bg-white border shadow-2xl p-6 relative z-10 text-center rounded-sm">
        <h4 class="text-[20px] text-black-900 font-bold uppercase tracking-widest mb-6">Jinsi Tunavyofanya Kazi</h4>
       <div class="grid grid-cols-3 gap-2 mb-6 border-b pb-8 text-center">
            <div class="flex flex-col items-center">
                <p class="text-red-600 font-black text-lg">1</p>
                <div class="text-2xl my-1">
                    <p class="text-[10px] md:text-[12px] uppercase font-black leading-tight">Chagua Bidhaa</p>
                    üõí</div> 
            </div>

            <div class="flex flex-col items-center">
                <p class="text-red-600 font-black text-lg">2</p>
                <div class="text-2xl my-1">
                    <p class="text-[10px] md:text-[12px] uppercase font-black leading-tight">Hakiki Oda Yako</p>
                    üìã</div> 
            </div>

            <div class="flex flex-col items-center">
                <p class="text-red-600 font-black text-lg">3</p>
                <div class="text-2xl my-1">
                    <p class="text-[10px] md:text-[12px] uppercase font-black leading-tight">Pokea Oda Yako</p>
                    üì¶</div> 
            </div>
        </div>

<div class="mt-6 mb-8 text-center sm:text-left">
    <p class="text-xs font-black text-black-900 uppercase tracking-[0.2em] mb-2">
        Weka oda kwa simu sasa:
    </p>
    
    <a href="tel:+255685636220" 
       class="inline-block text-3xl md:text-5xl font-black text-red-600 tracking-tighter hover:scale-105 transition-transform active:opacity-70">
        +255 685 636 220
    </a>

    <div class="flex items-center justify-center sm:justify-start gap-2 mt-2 text-blue-600 font-bold text-[10px] uppercase tracking-widest">
        <span class="animate-ping inline-flex h-2 w-2 rounded-full bg-blue-400 opacity-75"></span>
        Bofya namba hapo juu kupiga simu
    </div>
</div>        
    </section>

    <section class="container mx-auto mt-12 px-4 max-w-6xl">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div class="relative flex-grow max-w-md">
                <input type="text" id="product-search" onkeyup="filterProducts()" placeholder="Tafuta Azam, Mo, ID..." 
                       class="w-full p-3 pl-10 border border-gray-300 rounded focus:ring-2 focus:ring-red-600 outline-none shadow-sm">
                <span class="absolute left-3 top-3 text-gray-400"></span>
            </div>
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2" id="category-tabs">
                <button onclick="filterByCategory('All')" class="category-tab active px-5 py-2 border rounded-full text-[10px] font-bold uppercase tracking-tighter whitespace-nowrap">Bidhaa Zote</button>
                <button onclick="filterByCategory('Grains')" class="category-tab px-5 py-2 border rounded-full text-[10px] font-bold uppercase tracking-tighter whitespace-nowrap">Nafaka</button>
                <button onclick="filterByCategory('Oils')" class="category-tab px-5 py-2 border rounded-full text-[10px] font-bold uppercase tracking-tighter whitespace-nowrap">Mafuta</button>
                <button onclick="filterByCategory('Drinks')" class="category-tab px-5 py-2 border rounded-full text-[10px] font-bold uppercase tracking-tighter whitespace-nowrap">Vinywaji</button>
            </div>
        </div>

        
        <section class="container mx-auto mt-12 px-4 max-w-6xl">
    <div class="mb-16">
        <h3 class="text-xl font-black text-gray-800 mb-6 border-l-4 border-red-600 pl-3 uppercase tracking-tighter italic">Nafaka na Chakula</h3>
        <div id="product-list-nafaka" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6"></div>
        <button id="btn-nafaka" onclick="expandSection('nafaka')" class="hidden mx-auto mt-8 bg-gray-100 hover:bg-gray-200 text-gray-800 font-black py-3 px-8 rounded-full text-xs uppercase tracking-widest transition">Tazama Zaidi</button>
    </div>

    <div class="mb-16">
        <h3 class="text-xl font-black text-gray-800 mb-6 border-l-4 border-yellow-500 pl-3 uppercase tracking-tighter italic">Vinywaji Baridi</h3>
        <div id="product-list-vinywaji" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6"></div>
        <button id="btn-vinywaji" onclick="expandSection('vinywaji')" class="hidden mx-auto mt-8 bg-gray-100 hover:bg-gray-200 text-gray-800 font-black py-3 px-8 rounded-full text-xs uppercase tracking-widest transition">Tazama Zaidi</button>
    </div>

    <div class="mb-16">
        <h3 class="text-xl font-black text-gray-800 mb-6 border-l-4 border-blue-600 pl-3 uppercase tracking-tighter italic">Mengineyo</h3>
        <div id="product-list-mengineyo" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6"></div>
        <button id="btn-mengineyo" onclick="expandSection('mengineyo')" class="hidden mx-auto mt-8 bg-gray-100 hover:bg-gray-200 text-gray-800 font-black py-3 px-8 rounded-full text-xs uppercase tracking-widest transition">Tazama Zaidi</button>
    </div>

    <div id="no-results" class="hidden text-center py-20 text-gray-400 font-bold uppercase tracking-widest">Hatuna hii bidhaa kwa sasa.</div>
</section>
        
    </main>

    <section id="faq-section" class="bg-gray-50 py-16 mt-12 border-t border-b">
        <div class="max-w-2xl mx-auto px-4">
            <h3 class="text-2xl font-bold text-center mb-10 uppercase tracking-tighter">Maswali Yanayoulizwa Mara Kwa Mara</h3>
            <div class="space-y-4">
                <details class="bg-white p-5 border rounded-sm shadow-sm group">
                    <summary class="font-bold text-sm cursor-pointer list-none flex justify-between items-center uppercase tracking-tight">
                        Je, nitalipaje mzigo wangu? <span class="text-red-600 group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <p class="text-gray-600 text-sm mt-4 leading-relaxed">Lipa Baada ya Kupokea: Hatupokei pesa kabla ya mzigo kufika. Ukikagua mzigo wako na kuridhika, ndipo unalipa kwa Cash au M-Pesa. Hakuna risk yoyote kwako.</p>
                </details>
                <details class="bg-white p-5 border rounded-sm shadow-sm group">
                    <summary class="font-bold text-sm cursor-pointer list-none flex justify-between items-center uppercase tracking-tight">
                        Nikipata mzigo tofauti na niliyoagiza inakuwaje? <span class="text-red-600 group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <p class="text-gray-600 text-sm mt-4 leading-relaxed">Kagua Kwanza: Dereva akifika, fungua na kagua bidhaa zako. Ukiona kitu kimekosekana au kimeharibika, rudisha papo hapo bila gharama yoyote. Utalipia tu kile ulichokubali.</p>
                </details>
                <details class="bg-white p-5 border rounded-sm shadow-sm group">
                    <summary class="font-bold text-sm cursor-pointer list-none flex justify-between items-center uppercase tracking-tight">
                        Inachukua muda gani mzigo kufika? <span class="text-red-600 group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <p class="text-gray-600 text-sm mt-4 leading-relaxed">Ndani ya Dakika 30-60: Tunajua biashara yako inategemea stock. Tukishathibitisha oda yako kupitia WhatsApp, dereva wetu anaanza safari mara moja. Hutahitaji kufunga duka kwenda sokoni.</p>
                </details>
                <details class="bg-white p-5 border rounded-sm shadow-sm group">
                    <summary class="font-bold text-sm cursor-pointer list-none flex justify-between items-center uppercase tracking-tight">
                        Sijui kutumia website, nitawezaje kuagiza? <span class="text-red-600 group-open:rotate-180 transition-transform">‚ñº</span>
                    </summary>
                    <p class="text-gray-600 text-sm mt-4 leading-relaxed">Agiza kwa WhatsApp au Simu: Website yetu ni kama "catalog" ya kuona bei tu. Unaweza kutupigia simu moja kwa moja au kutuma picha ya bidhaa unazotaka kupitia WhatsApp. Tunafanya kazi rahisi kwako.</p>
                </details>
            </div>
        </div>
    </section>

    <section class="py-12 bg-white">
    <div class="container mx-auto px-4">
        <p class="text-[20px] text-center font-bold text-black uppercase tracking-widest mb-10">
            Chanzo rasmi cha bidhaa za uhakika kutoka kwa:
        </p>
        
        <div class="grid grid-cols-2 md:grid-cols-6 gap-8 md:gap-10 items-center justify-items-center">
            <img src="brands/azam.jpg" class="h-16 md:h-12 object-contain p-2" alt="Azam">
            <img src="brands/mo1.jpg" class="h-16 md:h-12 object-contain p-2" alt="Mo Dewji">
            <img src="brands/jambo.png" class="h-16 md:h-12 object-contain p-2" alt="Jambo">
            <img src="brands/cocacola.png" class="h-16 md:h-12 object-contain p-2" alt="Coca Cola">
            <img src="brands/pepsi.jpg" class="h-16 md:h-12 object-contain p-2" alt="Pepsi">
            <img src="brands/gsm.png" class="h-16 md:h-12 object-contain p-2" alt="GSM">
        </div>
        
        <p class="text-center text-[15px] font-bold text-black mt-10 italic uppercase">
            Bidhaa zote za jumla kwa bei halisi ya sokoni.
        </p>
    </div>
</section>

    <div id="cart-trigger" class="fixed bottom-6 right-6 hidden z-40">
        <button onclick="openPopup('cart-modal')" class="bg-red-600 text-white px-8 py-4 rounded-full shadow-2xl font-bold flex items-center gap-3 hover:scale-105 transition transform">
            <span class="uppercase text-xs tracking-widest">Tazama Oda</span>
            <span id="cart-count" class="bg-white text-red-600 px-2 rounded-full text-xs">0</span>
        </button>
    </div>

   <div id="product-modal" class="modal">
    <div class="bg-white w-full max-w-md rounded-sm overflow-hidden relative shadow-2xl">
        
        <div class="w-full h-64 bg-gray-100 flex items-center justify-center p-4">
            <img id="modal-img" src="" 
                 class="max-w-full max-h-full object-contain" 
                 alt="Product Preview">
        </div>

        <div class="p-6 md:p-8">
            <div id="modal-id" class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-1"></div>
            <h2 id="modal-name" class="text-2xl font-black mb-2 text-gray-900 leading-tight"></h2>
            <p id="modal-price" class="text-red-600 font-black text-3xl mb-4"></p>
            <p id="modal-desc" class="text-gray-500 text-sm mb-8 leading-relaxed border-l-4 border-red-600 pl-4"></p>
            
            <div class="flex flex-col gap-4 border-t pt-6">
                <div class="flex items-center justify-between w-full">
                    
                    <div class="flex items-center border-2 border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <button onclick="changeQty(-1)" 
                                class="px-6 py-4 bg-gray-100 active:bg-gray-300 text-xl font-black transition-colors border-r-2 border-gray-200">
                            ‚àí
                        </button>
                        
                        <span id="modal-qty" class="px-8 py-4 font-black text-2xl min-w-[70px] text-center bg-white">
                            0
                        </span>
                        
                        <button onclick="changeQty(1)" 
                                class="px-6 py-4 bg-red-50 text-red-600 active:bg-red-200 text-xl font-black transition-colors">
                            +
                        </button>
                    </div>

                    <button onclick="confirmAddToCart()" 
                            class="bg-red-600 text-white px-6 py-5 font-black rounded-lg uppercase text-[11px] tracking-widest shadow-xl active:scale-95 transition-all">
                        Agiza Sasa
                    </button>
                </div>
            </div>
        </div>
        
        <button onclick="closePopup('product-modal')" 
                class="absolute top-4 right-4 bg-white text-gray-900 w-12 h-12 rounded-full shadow-xl font-black flex items-center justify-center border-2 border-gray-100 active:bg-red-600 active:text-white transition">
            ‚úï
        </button>
    </div>
</div>

    <div id="cart-modal" class="modal">
      <div class="bg-white w-full max-w-sm mx-auto rounded-sm shadow-2xl modal-content-scroll">
        <div class="p-6 border-b sticky top-0 bg-white z-10 flex justify-between items-center">
            <h2 class="text-lg font-black uppercase tracking-tighter italic text-red-600">Muhtasari wa Oda Yako</h2>
            <button onclick="closePopup('cart-modal')" class="text-gray-400 text-xl font-bold">‚úï</button>
        </div>

        <div id="cart-items" class="p-6 space-y-4 overflow-y-auto flex-grow" style="max-height: 200px;">
            </div>

        <div class="p-6 border-t bg-gray-50">
            <div class="space-y-3 mb-6">
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Maelezo ya Ufikishaji</p>
                <input type="tel" id="cust-phone" placeholder="Namba yako ya Simu" 
                    class="w-full border-2 p-3 rounded-sm text-sm font-bold focus:border-red-600 outline-none transition-colors">
                <input type="text" id="cust-name" placeholder="Jina lako (Mfano: Simba)" 
                    class="w-full border-2 p-3 rounded-sm text-sm font-bold focus:border-red-600 outline-none transition-colors">
                <input type="text" id="cust-loc" placeholder="Mahali (Mtaa/Jengo)" 
                    class="w-full border-2 p-3 rounded-sm text-sm font-bold focus:border-red-600 outline-none transition-colors">
            </div>

            <div class="space-y-2 mb-4 border-b-2 border-dashed pb-4">
                <div class="flex justify-between text-xs font-bold text-gray-500 uppercase">
                    <span>Thamani ya Bidhaa:</span>
                    <span id="subtotal-amount">Tsh 0</span>
                </div>
                <div class="flex justify-between text-xs font-black text-red-600 uppercase">
                    <span>Nauli (Popote Dar):</span>
                    <span>Tsh 5,000</span>
                </div>
            </div>

            <div class="flex justify-between items-center mb-6">
                <span class="text-sm font-black text-gray-800 uppercase italic">Jumla Kuu:</span>
                <span id="cart-total" class="text-2xl font-black text-gray-900 tracking-tighter">Tsh 5,000</span>
            </div>

            <button onclick="sendWhatsApp()" class="w-full bg-green-600 text-white py-5 rounded-lg font-black uppercase tracking-widest text-xs shadow-xl active:scale-95 transition flex items-center justify-center gap-2">
                <span>Thibitisha Oda WhatsApp</span>
            </button>
            
            <button onclick="closePopup('cart-modal')" class="w-full text-center text-[10px] font-black text-gray-400 uppercase mt-5 tracking-widest hover:text-red-600 transition">
                ‚Üê Ongeza Bidhaa Nyingine
            </button>
        </div>
    </div>
</div> 

    <!-- Success Toast Notification -->
     <div id="success-toast">‚úÖ Oda Imepokelewa! Asante.</div>

    <script>
        const products = [
         
            /* Nafaka na Chakula */

            { id: "AS-01", brand: "Asas", name: "Maziwa ya Asas", price: 16000, category: "Oils", desc: "Boxi la Maziwa ya Asas.", img: "grain/ASAS_MILK-removebg.png" },
            { id: "Az-011", brand: "Azam", name: "Nazi ya Azam", price: 30000, category: "Oils", desc: "Boxi ya Nazi ya Azam", img: "grain/AZAM_COCONUT_CREAM-removebg.png" },
            { id: "Az-012", brand: "Azam", name: "Bisuit za Azam", price: 15000, category: "Oils", desc: "Boxi la Biscuit za Azam", img: "grain/AZAM-MARIE-GINGER-removebg.png" },
            { id: "Az-013", brand: "Azam", name: "Unga wa PPf", price: 21500, category: "Oils", desc: "Unga wa PPF - 1", img: "grain/Azam-PPF-1.png" },
            { id: "Kr-10", brand: "Korie", name: "Mafuta ya Korie", price: 29500, category: "Oils", desc: "Mafuta ya kula ya lita 1", img: "grain/Korie Cooking Oil 900Ml.webp" },
            { id: "Kr-10", brand: "Korie", name: "Mafuta ya Korie", price: 39000, category: "Oils", desc: "Mafuta ya kula ya lita 20", img: "grain/Korie Cooking.webp" },
            { id: "S-10", brand: "Singida", name: "Mafuta ya Kula", price: 30900, category: "Oils", desc: "Mafuta ya kula ya lita 5", img: "grain/SINGIDA_COOKING_OIL-removebg.png" },
            { id: "Mo-10", brand: "Mo", name: "Tambi za Mo", price: 23000, category: "Oils", desc: "Boxi La Tambi za Mo", img: "grain/mospagheti-removebg.png" },
            { id: "Rg-10", brand: "Redgold", name: "Redgold Tomato Sauce", price: 16000, category: "Oils", desc: "Boxi la Redgold Tomato Sauce", img: "grain/tomatopaste70g-removebg.png" },
            { id: "Rg-10", brand: "Redgold", name: "Redgold Tomato Paste", price: 13500, category: "Oils", desc: "Boxi la Redgold Tomato Paste", img: "grain/redgold-tomato-removebg.png" },
            { id: "S-10", brand: "Singida", name: "Mafuta ya Kula", price: 15000, category: "Oils", desc: "Mafuta ya kula ya lita 5", img: "oil/SINGIDA COOKING OIL.jpg" },
            { id: "S-10", brand: "Singida", name: "Mafuta ya Kula", price: 15000, category: "Oils", desc: "Mafuta ya kula ya lita 5", img: "oil/SINGIDA COOKING OIL.jpg" },
            { id: "S-10", brand: "Singida", name: "Mafuta ya Kula", price: 15000, category: "Oils", desc: "Mafuta ya kula ya lita 5", img: "oil/SINGIDA COOKING OIL.jpg" },
            { id: "S-10", brand: "Singida", name: "Mafuta ya Kula", price: 15000, category: "Oils", desc: "Mafuta ya kula ya lita 5", img: "oil/SINGIDA COOKING OIL.jpg" },

                
           
            /* Vinywaji */

            { id: "MO-01", brand: "METL", name: "Mo Cola", price: 4700, category: "Drinks", desc: "Katoni ya Soda ya Mo Cola. Ujazo 300Ml. Idadi 12", img: "drinks/mocola-1-removebg-preview.png" },
            { id: "MO-02", brand: "METL", name: "Mo xtra", price: 4800, category: "Drinks", desc: "Katoni ya Energy drink ya Mo. Ujazo 300Ml. Idadi 12", img: "drinks/moextra1-removebg.png" },
            { id: "MO-03", brand: "METL", name: "Mo Chungwa", price: 4600, category: "Drinks", desc: "Katoni ya Juisi ya Mo Chungwa. Ujazo 300Ml. Idadi 12", img: "drinks/moorange-removebg.png" },
            { id: "MO-04", brand: "METL", name: "Mo Passion", price: 4800, category: "Drinks", desc: "Katoni ya Juisi ya Mo Passion. Ujazo 300Ml. Idadi 12", img: "drinks/mopassion-removebg.png" },
            { id: "Az-01", brand: "Azam", name: "Azam Cola", price: 9400, category: "Drinks", desc: "Pure drinking water. Ujazo 300Ml. Idadi 12", img: "drinks/AZAM-COLA-CROPPED.png" },
            { id: "Az-02", brand: "Azam", name: "Azam Energy", price: 11950, category: "Drinks", desc: "Katoni ya Juisi ya Azam Energy. Ujazo 300Ml. Idadi 12", img: "drinks/azam_energy-removebg.png" },
            { id: "Az-03", brand: "Azam", name: "Azam Apple Punch", price: 9500, category: "Drinks", desc: "Katoni ya juisi ya Apple Punch. Ujazo 300Ml. Idadi 12", img: "drinks/Azam-Apple-Punch-300ml-removebg.png" },
            { id: "Az-04", brand: "Azam", name: "Azam Embe", price: 10700, category: "Drinks", desc: "Katoni ya juisi ya Azam Embe. Ujazo 300Ml. Idadi 12", img: "drinks/Azam-Mango-1Litre-removebg.png" },
            { id: "Az-05", brand: "Azam", name: "Azam Max", price: 9500, category: "Drinks", desc: "Katoni ya juisi ya Azam Max. Ujazo 300Ml. Idadi 12", img: "drinks/AZAM-MAX2.png" },
            { id: "Az-06", brand: "Azam", name: "Azam Swiss", price: 9500, category: "Drinks", desc: "Katoni ya juisi ya Azam Swiss. Ujazo 300Ml. Idadi 12", img: "drinks/Swiss-New-removebg.png" },
            { id: "AF-01", brand: "Afia", name: "Afiya Strawberry", price: 4600, category: "Drinks", desc: "Katoni ya juisi ya Afiya Nyeusi. Ujazo 300Ml. Idadi 12", img: "drinks/afyablack-removebg.png" },
            { id: "AF-02", brand: "Afiya", name: "Afiya Orange", price: 4600, category: "Drinks", desc: "Katoni ya juisi ya Afiya Orange. Ujazo 300Ml. Idadi 12", img: "drinks/afyaorange-removebg.png" },
            { id: "AF-03", brand: "Afiya", name: "Afiya Passion", price: 4600, category: "Drinks", desc: "Katoni ya juisi ya Afiya Passion. Ujazo 300Ml. Idadi 12", img: "drinks/afyapasion-removebg.png" },
            { id: "AF-04", brand: "Afiya", name: "Afiya Malta", price: 4600, category: "Drinks", desc: "Katoni ya juisi ya Afiya Malta. Ujazo 300Ml. Idadi 12", img: "drinks/afyamalta-removebg.png" },
            { id: "AF-05", brand: "Afiya", name: "Afiya Pineapple", price: 4600, category: "Drinks", desc: "Katoni ya juisi ya Afiya Pineapple. Ujazo 300Ml. Idadi 12", img: "drinks/afiyapineapple-removebg.png" },
            
            /* Mengineyo */

            { id: "SH-09", brand: "Shwari", name: "Shwari Toilet Paper", price: 10000, category: "Others", desc: "Box la toilet paper za shwari.", img: "other/SHWARI_TOILET_PAPER-removebg.png" },
            { id: "Mo-01", brand: "Mo", name: "Mo Taifa Blue", price: 10000, category: "Others", desc: "Box la Sabuni za Mo za Unga.", img: "other/motaifablue-removebg.png" },
            { id: "Mo-02", brand: "Mo", name: "Mo Taifa Yellow", price: 10000, category: "Others", desc: "Box la Sabuni za Mo za Unga.", img: "other/motaifayellow-removebg.png" },
            { id: "Mo-03", brand: "Mo", name: "Mo Halisi Red", price: 10000, category: "Others", desc: "Box la Sabuni za Mo za Unga.", img: "other/mohalisi1-removebg.png" },
            { id: "Mo-04", brand: "Mo", name: "Mo soap", price: 10000, category: "Others", desc: "Box la sabuni ya Kuogea.", img: "other/mosoap-removebg.png" },
            { id: "SF-01", brand: "Softcare", name: "Softcare Diaper", price: 10000, category: "Others", desc: "Box la Softcare Diapersi.", img: "other/SOFTCARE_DIAPERS-removebg.png" },
            { id: "SF-09", brand: "Softcare", name: "Softcare Pads", price: 34000, category: "Others", desc: "Box la Softcare Pads.", img: "other/SOFTCARE_PADS-removebg.png" },
            { id: "Mk-01", brand: "Mk", name: "Mosquito King", price: 20650, category: "Others", desc: "Box la dawa ya Mbu.", img: "other/dawayambuuu-removebg.png" },
            { id: "Df-01", brand: "Doffi", name: "Doffi Yellow", price: 9850, category: "Others", desc: "Box la Doffi Yellow.", img: "other/doffiyellow-removebg.png" },
            { id: "Df-02", brand: "Doffi", name: "Doffi Pink", price: 9850, category: "Others", desc: "Box la Doffi Pink", img: "other/doffipink-removebg.png" },
            { id: "Ks-09", brand: "Kleesoft", name: "Sabuni Ya Kleesoft", price: 4150, category: "Others", desc: "Box la Sabuni ya Kleesoft.", img: "other/Kleesoft-removebg.png" },
            { id: "Nc-09", brand: "Niceone", name: "Sabuni Ya Niceone", price: 9700, category: "Others", desc: "Box la Sabuni ya Niceone.", img: "other/niceone-removebg.png" },
            { id: "An-01", brand: "Azania", name: "Sabuni ya Marhaba", price: 4300, category: "Others", desc: "Box la Sabuni ya Marhaba.", img: "other/Marhaba-removebg.png" },
            { id: "Vv-01", brand: "Viva", name: "Viva Tissue Paper", price: 10000, category: "Others", desc: "Box la Tissue paper za Viva.", img: "other/vivasoft-removebg.png" },
            { id: "Jm-01", brand: "Jamaa", name: "Sabuni ya Jamaa", price: 15150, category: "Others", desc: "Box la Miche ya Jamaa.", img: "other/sabuniyajamaa-removebg.png" },

        ];

        let cart = [];
        let currentProduct = null;
        let currentQty = 1;

        let isExpanded = { essentials: false, others: false };

      

       // Keep track of section states
let expandedSections = { nafaka: false, vinywaji: false, mengineyo: false };

function renderGrid(data) {
    // Store current data globally so buttons can access it
    window.lastRenderedData = data;

    const grids = {
        nafaka: document.getElementById('product-list-nafaka'),
        vinywaji: document.getElementById('product-list-vinywaji'),
        mengineyo: document.getElementById('product-list-mengineyo')
    };
    const noRes = document.getElementById('no-results');
    
    Object.values(grids).forEach(g => { if(g) g.innerHTML = ''; });
    
    if (!data || data.length === 0) {
        noRes.classList.remove('hidden');
        return;
    } 
    noRes.classList.add('hidden');

    const limit = window.innerWidth < 768 ? 6 : 10;

    const categorized = {
        nafaka: data.filter(p => ['Grains', 'Oils', 'Pasta', 'Nafaka'].includes(p.category)),
        vinywaji: data.filter(p => ['Drinks', 'Vinywaji', 'Soda'].includes(p.category)),
        mengineyo: data.filter(p => !['Grains', 'Oils', 'Pasta', 'Nafaka', 'Drinks', 'Vinywaji', 'Soda'].includes(p.category))
    };

    Object.keys(categorized).forEach(key => {
        const list = categorized[key];
        const grid = grids[key];
        const btn = document.getElementById(`btn-${key}`);
        
        if (!grid) return;

        const isExpanded = expandedSections[key];
        const itemsToShow = isExpanded ? list : list.slice(0, limit);

        itemsToShow.forEach(p => {
            grid.innerHTML += `
                <div class="border border-gray-200 rounded-sm hover:shadow-lg transition-all cursor-pointer flex flex-col group bg-white" onclick="openProduct('${p.id}')">
                    <div class="w-full h-48 bg-gray-50 flex items-center justify-center overflow-hidden p-2 relative">
                        <img src="${p.img}" onerror="this.src='https://via.placeholder.com/400?text=Product'" class="max-w-full max-h-full object-contain group-hover:scale-105 transition duration-300">
                        <span class="absolute top-2 left-2 bg-white/90 text-black text-[9px] px-2 py-0.5 font-bold rounded shadow-sm border border-gray-100 uppercase tracking-tighter">ID: ${p.id}</span>
                    </div>
                    <div class="p-3 border-t border-gray-50">
                        <p class="text-[10px] font-bold text-blue-600 uppercase tracking-tight mb-0.5">${p.brand || 'SIMBA'}</p>
                        <h4 class="font-bold text-gray-900 text-sm leading-tight h-10 line-clamp-2">${p.name}</h4>
                        <div class="mt-2 flex items-center justify-between">
                            <p class="text-red-600 font-extrabold text-sm">Tsh ${p.price.toLocaleString()}</p>
                            <span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">${p.category}</span>
                        </div>
                    </div>
                </div>`;
        });

        // 5. REMODELED BUTTON LOGIC
        if (btn) {
            // Only show button if the list is longer than the limit
            if (list.length > limit) {
                btn.classList.remove('hidden');
                if (isExpanded) {
                    btn.innerText = "Tazama Chache";
                    btn.setAttribute("onclick", `collapseSection('${key}')`);
                    btn.classList.replace('bg-gray-100', 'bg-gray-800'); // Darker when expanded
                    btn.classList.replace('text-gray-800', 'text-white');
                } else {
                    btn.innerText = "Tazama Zaidi";
                    btn.setAttribute("onclick", `expandSection('${key}')`);
                    btn.classList.replace('bg-gray-800', 'bg-gray-100');
                    btn.classList.replace('text-white', 'text-gray-800');
                }
            } else {
                btn.classList.add('hidden');
            }
        }
        
        grid.parentElement.style.display = list.length === 0 ? 'none' : 'block';
    });
}

// Function to Expand
function expandSection(key) {
    expandedSections[key] = true;
    renderGrid(window.lastRenderedData);
}

// Function to Collapse (Tazama Chache)
function collapseSection(key) {
    expandedSections[key] = false;
    renderGrid(window.lastRenderedData);
    
    // Scroll back to the section header so the user isn't lost
    document.getElementById(`btn-${key}`).parentElement.scrollIntoView({ behavior: 'smooth' });
}
        function filterProducts() {
            const query = document.getElementById('product-search').value.toLowerCase();
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(query) || p.brand.toLowerCase().includes(query) || p.id.toLowerCase().includes(query)
            );
            renderGrid(filtered);
        }

        function filterByCategory(cat) {
            document.querySelectorAll('.category-tab').forEach(t => t.classList.toggle('active', t.innerText.toLowerCase() === cat.toLowerCase()));
            const filtered = cat === 'All' ? products : products.filter(p => p.category === cat);
            renderGrid(filtered);
        }

        function openProduct(id) {
        currentProduct = products.find(p => p.id === id);
        currentQty = 1;

        // 1. Update Image & Proportions
        const modalImg = document.getElementById('modal-img');
        modalImg.src = currentProduct.img;
        
        // Fallback if local photo is missing
        modalImg.onerror = function() {
            this.src = 'https://via.placeholder.com/600x400?text=Product+Image+Not+Found';
        };

        // 2. Update Text Content
        document.getElementById('modal-id').innerText = `SKU: ${currentProduct.id} | ${currentProduct.brand}`;
        document.getElementById('modal-name').innerText = currentProduct.name;
        document.getElementById('modal-price').innerText = `Tsh ${currentProduct.price.toLocaleString()}`;
        document.getElementById('modal-desc').innerText = currentProduct.desc;
        document.getElementById('modal-qty').innerText = currentQty;

        openPopup('product-modal');
    }

        function changeQty(amt) {
            currentQty = Math.max(1, currentQty + amt);
            document.getElementById('modal-qty').innerText = currentQty;
        }

        function confirmAddToCart() {
            const existing = cart.find(i => i.id === currentProduct.id);
            if(existing) existing.qty += currentQty;
            else cart.push({...currentProduct, qty: currentQty});
            closePopup('product-modal');
            updateCartUI();
        }

    function updateCartUI() {
    const trigger = document.getElementById('cart-trigger');
    const countEl = document.getElementById('cart-count');
    const itemsEl = document.getElementById('cart-items');
    const totalEl = document.getElementById('cart-total');
    const subtotalEl = document.getElementById('subtotal-amount'); // New element from your HTML

    const deliveryFee = 5000;

    if (cart.length === 0) {
        trigger.classList.add('hidden');
        itemsEl.innerHTML = '<p class="text-center text-gray-400 py-4 text-xs italic uppercase">Kapu lako halina bidhaa</p>';
        if (subtotalEl) subtotalEl.innerText = 'Tsh 0';
        totalEl.innerText = 'Tsh 0'; // Or 'Tsh 5,000' if you want it preloaded even when empty
        return;
    }

    trigger.classList.remove('hidden');
    countEl.innerText = cart.reduce((s, i) => s + i.qty, 0);

    let subtotal = 0;
    itemsEl.innerHTML = cart.map((i, index) => {
        subtotal += (i.price * i.qty);
        return `
            <div class="flex justify-between items-center text-sm border-b border-gray-50 pb-3 mb-2">
                <div class="flex-grow">
                    <div class="font-bold text-gray-800">${i.name}</div>
                    <div class="text-[10px] text-gray-400 uppercase font-black">Qty: ${i.qty} | Tsh ${i.price.toLocaleString()} ea</div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-red-600 font-black text-right whitespace-nowrap">Tsh ${(i.price * i.qty).toLocaleString()}</div>
                    <button onclick="removeItem(${index})" class="text-gray-300 hover:text-red-600 transition p-1 text-lg" title="Ondoa">
                        üóëÔ∏è
                    </button>
                </div>
            </div>`;
    }).join('');

    // Update the Transparent Billing section
    if (subtotalEl) {
        subtotalEl.innerText = `Tsh ${subtotal.toLocaleString()}`;
    }

    // Final Grand Total (Subtotal + 5,000)
    const grandTotal = subtotal + deliveryFee;
    totalEl.innerText = `Tsh ${grandTotal.toLocaleString()}`;
}
        function removeItem(index) {
            // Remove the item from the array
            cart.splice(index, 1);
            
            // Refresh the UI to show the updated list
            updateCartUI();
            
            // If the cart becomes empty after removal, close the modal
            if (cart.length === 0) {
                setTimeout(() => {
                    closePopup('cart-modal');
                }, 300);
            }
        }

        function toggleCartShortcut() {
            if (cart.length === 0) {
                alert("Ongeza bidhaa kwenye kikapu kwanza.");
                window.scrollTo({ top: document.getElementById('product-search').offsetTop - 100, behavior: 'smooth' });
            } else {
                openPopup('cart-modal');
            }
        }

   function sendWhatsApp() {
    const phone = document.getElementById('cust-phone').value;
    const name = document.getElementById('cust-name').value;
    const loc = document.getElementById('cust-loc').value;
    
    // 1. Validation: Ensure all fields are filled
    if(!phone || !name || !loc) {
        return alert("Tafadhali jaza namba, jina, na mahali unapatikana!");
    }
    
    // 2. Calculate Costs
    const subtotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);
    const deliveryFee = 5000;
    const grandTotal = subtotal + deliveryFee;

    // 3. Generate Item List
    const itemsTxt = cart.map(i => `‚Ä¢ ${i.name} (Qty: ${i.qty})`).join('%0A');
    
    // 4. WhatsApp Message with Transparent Billing
    const msg = `*MZIGO MPYA - SIMBA EXPRESS*%0A%0A` +
                `*Mteja:* ${name}%0A` +
                `*Simu:* ${phone}%0A` +
                `*Mahali:* ${loc}%0A%0A` +
                `*Vitu Alivyochagua:*%0A${itemsTxt}%0A%0A` +
                `---------------------------%0A` +
                `*Thamani ya Bidhaa:* Tsh ${subtotal.toLocaleString()}%0A` +
                `*Nauli (Popote Dar):* Tsh ${deliveryFee.toLocaleString()}%0A` +
                `*JUMLA KUU:* Tsh ${grandTotal.toLocaleString()}%0A` +
                `---------------------------%0A` +
                `_Malipo ni baada ya mzigo kufika._%0A` +
                `_Mzigo utafika ndani ya dakika 60._`;
    
    // 5. Open WhatsApp
    window.location.href = `https://wa.me/255685636220?text=${msg}`;

    // 6. Show Success Toast and Reset
    const toast = document.getElementById("success-toast");
    toast.className = "show";

    setTimeout(() => {
        toast.className = toast.className.replace("show", "");
        cart = []; 
        document.getElementById('cust-phone').value = '';
        document.getElementById('cust-name').value = '';
        document.getElementById('cust-loc').value = '';
        updateCartUI(); 
        closePopup('cart-modal'); 
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 3000);
}

        function openPopup(id) { document.getElementById(id).classList.add('active'); }
        function closePopup(id) { document.getElementById(id).classList.remove('active'); }

        window.onload = () => renderGrid(products);
    </script>
</body>
</html>